<h1>Requests dashboard</h1>

<table class='table dashboard-table'>
  <tr>
    <% @dashboard.metrics.each do |metric| %>
      <td class='col-sm-<%= 12 / @dashboard.metrics.length %>'>
        <h3><%= @dashboard.send(metric) %></h3>
      </td>
    <% end %>
  </tr>
  <tfoot>
    <tr>
      <% @dashboard.metrics.each do |metric| %>
        <td>
          <span class='text-muted'>
            <%=
              # if the metric is selected, give an [x] link to go back to the unfiltered request
              # list.  otherwise, give a link to the filtered list for the request type.
              if filter_metric == metric
                (t(".#{metric}") + " ").html_safe + link_to('[x]', admin_index_path)
              else
                link_to(t(".#{metric}"), admin_index_path(metric: metric))
              end
            %>
          </span>
        </td>
      <% end %>
    </tr>
  </tfoot>
</table>

<div class='admin-requests'>
  <h2>Recent Requests</h2>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Type</th>
        <th>Origin</th>
        <th>Destination</th>
        <th>Title</th>
        <th>Requester</th>
        <th>Requested on</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <% @requests.each do |request| %>
        <tr>
          <td><%= request.type %></td>
          <td><%= request.origin %></td>
          <td><%= request.destination %></td>
          <td><%= searchworks_link(request.item_id, request.item_title, 'data-behavior' => 'truncate') %></td>
          <td><%= requester_info(request.user) %></td>
          <td><%= time_tag(request.created_at, :short) %></td>
          <td><%= link_to('Status', polymorphic_path([:status, request])) %></td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <%= paginate @requests, theme: 'bootstrap' %>

</div>
