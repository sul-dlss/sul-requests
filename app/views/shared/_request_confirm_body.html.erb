<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Confirmation Page</title>
    <link href="/stylesheets/request-forms.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		
		<!-- Toolbar --> 
		
		<%= render :partial => "shared/toolbar_links" %>
		
		<!-- Message: could be success or failure-->
		
		<% if @results.has_key?('2') %>
		
			<div class="request_failed"><p>

			<%=h @messages['2'] %>
		
			<% @results.clear %>
			
			</p></div>

		
		
		<% end %>
		
		<!-- Patron information: note variations in field names and parm names 
			 Need to add logic to figure out which fields to print.
		-->
		
		<div class="patron_info">
			<dl>

			<dd><%= @field_labels['patron_name'] %>: <%= @request['patron_name'] %></dd>
			<dd><%= @field_labels['library_id'] %>: <%= @request['library_id'] %></dd>
			<dd><%= @field_labels['pickup_lib'] %>: <%= @request['pickup_lib'] %></dd>
			
		</dl>
		</div> 
		
		<!-- end of patron info -->
		
		<!-- Bibliographic data -->
		
		<!-- Item information --> 
		
		<% if @results.has_key?('209') %>
			
			<%=h @messages['209'] %>
			<blockquote>
				<% items = @results['209'].split('^') %>
				<% items.each do |item| %>
				<%    fields = item.split('|') %>
				<%=h fields[1] %><br>
				<% end %>			
			</blockquote>
			<% @results.delete('209') %>
		<% end %>			
		
		<% if ! @results.empty?  %>
			Your requests for the following items could not be placed for the reasons shown:
			<blockquote>
				<% @results.each do |key, value| %>
					<%=h @messages[key] %>
					<blockquote>
					<% items = value.split('^') %>
					<% items.each do |item| %>
					<%    fields = item.split('|') %>
					<%=h fields[1] %> <br>	
					<% end %>
					</blockquote>	
				<% end %>	
			</blockquote>
		<% end %>
<hr>		
		<!-- Extra information that may be useful for debugging. Delete this in prod version -->
		
		<p>Information below the horizontal line is not part of the 
		display but is just shown temporarily to help with debugging.</p>
		<% unless flash[:debug].blank?%>
			<div id="notification"><%= flash[:debug] %></div>
		<% end %>
	</body>
</html>
