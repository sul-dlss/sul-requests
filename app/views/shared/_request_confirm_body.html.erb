<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Confirmation Page</title>
    <link href="/stylesheets/request-forms.css" rel="stylesheet" type="text/css">
	</head>
	<body>
	
<div id="header">		
		<!-- Toolbar --> 
		
		<%= render :partial => "shared/toolbar_links" %>
</div>		

<div id="container">
					
		<h1><%= @requestdef[:title] %></h1>
		
		<!-- Display failure messages only -->
		
		<% if @symresult.msgs.has_key?('2') # global failure, but may have more codes here %>
		
			<div class="request_failed"><p>

			<%=h @messages['2'] %>
		
			<% @symresult.msgs.clear %>
			
			</p>
			
			<!-- call return_to_request helper here and pass request object -->
		
			</div>
			
		<% elsif @symresult.msgs.has_key?('000')  %>	

			<div class="request_failed"><p>

			<%=h @messages['000'] %>
		
			<% @symresult.msgs.clear %>
			
			</p>
			
			<!-- call return_to_request helper here and pass request object -->
		
			</div>
		
		<% end %>
		
		<!-- End of message section -->
		
		<!-- Patron information. Need to add logic to figure out which fields to print.
		-->
		
		<div class="patron_info">
			<dl>
			<% if ! @request.patron_name.blank? %>
				<dt><%= @field_labels['patron_name'] %>:</dt><dd><%= @request.patron_name %></dd>
			<% end %>		
			
			<% if ! @request.library_id.blank? %>	
				<dt><%= @field_labels['library_id'] %>:</dt><dd> <%= @request.library_id %></dd>
			<% elsif ! @request.univ_id.blank? %>	
				<dt><%= @field_labels['univ_id'] %>:</dt><dd> <%= @request.univ_id %></dd>				
			<% end %>
			
			<% if ! @request.pickup_lib.blank? %>	
				<dt><%= @field_labels['pickup_lib'] %>:</dt><dd> <%= @request.pickup_lib %></dd>		
			<% end %>
			
			<% if ! @request.hold_recall.blank? %>
				<dt><%= @field_labels['hold_recall'] %>:</dt><dd> <%= @request.hold_recall %></dd>
			<% end %>
			<% if ! @request.not_needed_after.blank? %>
				<dt><%= @field_labels['not_needed_after'] %>:</dt><dd> <%= @request.not_needed_after %></dd>		
			<% elsif ! @request.planned_use.blank? %>
				<dt><%= @field_labels['planned_use'] %>:</dt><dd> <%= @request.planned_use %></dd>		

			<% end %>
			
		</dl>
		</div> 
		
		<!-- end of patron info -->
		
		<!-- Bibliographic data -->
		
		  <span class="title"><%= @request.params[:bib_info] %></span>
		  
		<!-- end of bibliographic data -->
		
		<!-- Item information --> 
		
				
		<% if @symresult.msgs.empty? %>
		
			<h2 class="fail">No items have been held.</h2>	
			
		<% else %>
		
			<% if @symresult.msgs.has_key?('209') %>
			
				<h2 class="success"><%=h @messages['209'] %></h2>
				<ul>
					<% items = @symresult.msgs['209'].split('^') %>
					<% items.each do |item| %>
					<%    fields = item.split('|') %>
					<li><%=h fields[1] %></li>
					<% end %>			
				</ul>
				<% @symresult.msgs.delete('209') %>
			<% end # key 209 successful results %>			
		
			<% if ! @symresult.msgs.empty?  %>
				<% @symresult.msgs.each do |key, value| %>
					<h2 class="fail"><%=h @messages[key] %></h2>
					<ul>
					<% items = value.split('^') %>
					<% items.each do |item| %>
					<%    fields = item.split('|') %>
					<li><%=h fields[1] %> </li>	
					<% end %>
					</ul>	
				<% end %>	

			<% end # unsuccessful results %>
			
		<% end # empty or not empty results %>		
		
		<!-- Link to return to SW or Soc -->
		
		<% if ! @request.return_url.blank? %>
			<a href="<%= @request.return_url %>">Return to SearchWorks</a>
		
		<% elsif @request.source == 'SO' %>
		
			<a href="javascript:self.close()">Close Window and Return to Socrates</a>
			
		<% end %>
		<% if  RailsEnv == 'development' %>
			<!-- End of item information -->	
	        <hr>		
			<!-- Extra information that may be useful for debugging. Delete this in prod version -->
			
			<p>Information below the horizontal line is not part of the 
			display but is just shown temporarily to help with debugging.</p>
			<% unless flash[:debug].blank?%>
				<div id="notification"><%= flash[:debug] %></div>
			<% end %>
		<% end %>
	</body>
</html>
