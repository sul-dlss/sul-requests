<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Confirmation Page</title>
    <link href="/stylesheets/request-forms.css" rel="stylesheet" type="text/css">
	</head>
	<body>
		
		<!-- Toolbar --> 
		
		<%= render :partial => "shared/toolbar_links" %>
				
		<h1><%= @requestdef[:title] %></h1>
		
		<!-- Display failure messages only -->
		
		<% if @results.has_key?('2') # global failure, but may have more codes here %>
		
			<div class="request_failed"><p>

			<%=h @messages['2'] %>
		
			<% @results.clear %>
			
			</p>
			
			<!-- call return_to_request helper here and pass request object -->
		
			</div>
			
		<% elsif @results.has_key?('000')  %>	
		
			<div class="request_failed"><p>

			<%=h @messages['000'] %>
		
			<% @results.clear %>
			
			</p>
			
			<!-- call return_to_request helper here and pass request object -->
		
			</div>
		
		<% elsif @results.has_key?('23') %>
			
			<div class="request_failed"><p>

			<%=h @messages['23'] %>
		
			<% @results.clear %>
			
			</p>
			
			<!-- call return_to_request helper here and pass request object -->
		
			</div>
		
		<% end %>
		
		<!-- End of message section -->
		
		<!-- Patron information. Need to add logic to figure out which fields to print.
		-->
		
		<div class="patron_info">
			<dl>
			<% if ! @request['patron_name'].nil? %>
				<dt><%= @field_labels['patron_name'] %>:</dt><dd><%= @request['patron_name'] %></dd>
			<% end %>		
			
			<% if ! @request['library_id'].nil? %>	
				<dt><%= @field_labels['library_id'] %>:</dt><dd> <%= @request['library_id'] %></dd>
			<% elsif ! @request['univ_id'].nil? %>	
				<dt><%= @field_labels['univ_id'] %>:</dt><dd> <%= @request['univ_id'] %></dd>				
			<% end %>
			
			<% if ! @request['pickup_lib'].nil? %>	
				<dt><%= @field_labels['pickup_lib'] %>:</dt><dd> <%= @request['pickup_lib'] %></dd>		
			<% end %>
			
			<% if ! @request['hold_recall'].nil? %>
				<dt><%= @field_labels['hold_recall'] %>:</dt><dd> <%= @request['hold_recall'] %></dd>
			<% end %>
			<% if ! @request['not_needed_after'].nil? %>
				<dt><%= @field_labels['not_needed_after'] %>:</dt><dd> <%= @request['not_needed_after'] %></dd>		
			<% elsif ! @request['planned_use'].nil? %>
				<dt><%= @field_labels['planned_use'] %>:</dt><dd> <%= @request['planned_use'] %></dd>		

			<% end %>
			
		</dl>
		</div> 
		
		<!-- end of patron info -->
		
		<!-- Bibliographic data -->
		
		  <span class="title"><%= @request['bib_info'] %></span>
		  
		<!-- end of bibliographic data -->
		
		<!-- Item information --> 
		
				
		<% if @results.empty? %>
		
			<h2 class="fail">No items have been held.</h2>	
			
		<% else %>
		
			<% if @results.has_key?('209') %>
			
				<h2 class="success"><%=h @messages['209'] %></h2>
				<ul>
					<% items = @results['209'].split('^') %>
					<% items.each do |item| %>
					<%    fields = item.split('|') %>
					<li><%=h fields[1] %></li>
					<% end %>			
				</ul>
				<% @results.delete('209') %>
			<% end # key 209 successful results %>			
		
			<% if ! @results.empty?  %>
				<% @results.each do |key, value| %>
					<h2 class="fail"><%=h @messages[key] %></h2>
					<ul>
					<% items = value.split('^') %>
					<% items.each do |item| %>
					<%    fields = item.split('|') %>
					<li><%=h fields[1] %> </li>	
					<% end %>
					</ul>	
				<% end %>	

			<% end # unsuccessful results %>
			
		<% end # empty or not empty results %>		
		
		<!-- End of item information -->	
<hr>		
		<!-- Extra information that may be useful for debugging. Delete this in prod version -->
		
		<p>Information below the horizontal line is not part of the 
		display but is just shown temporarily to help with debugging.</p>
		<% unless flash[:debug].blank?%>
			<div id="notification"><%= flash[:debug] %></div>
		<% end %>
		
		<div id="footer">

&copy; <a href="http://www.stanford.edu">Stanford University</a>. Stanford, California 94305. (650) 725-1064. <a href="http://library.stanford.edu/about_sulair/termsofuse.html">Terms of Use</a> | <a href="http://stanford.edu/site/copyright.html">Copyright Complaints</a></div>
	</body>
</html>
